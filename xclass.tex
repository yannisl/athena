\documentclass[10pt]{memoir}
\usepackage[top=20mm,bottom=20mm,left=25mm,right=25mm, a4paper]{geometry}
\newgeometry{left=2.5cm,right=3.5cm,top=2.5in,bottom=1.5cm, %left is inner
    marginparsep=5mm,marginparwidth=10mm,
    headheight=20mm,headsep=0.2cm,
    footskip=1.5cm}

\usepackage{microtype,soul,filecontents,pifont}
\usepackage[usenames,dvipsnames,svgnames]{xcolor}
\usepackage{amsmath,etoolbox}
 \usepackage{pgf}
\usepackage{tikz}
\usepackage{picture}
\usepackage{lettrine,caption,multicol}

\usepackage{lipsum,soul}
%\usepackage{palatino}
\usepackage{calligra}
\usepackage{fourier-orns}
%\usepackage[T1]{fontenc}

\usepackage{eso-pic}
\usepackage{layouts}
\usepackage{alphalph}
\usepackage{caption}
\usepackage{fmtcount}
\usepackage[listings,theorems]{tcolorbox}
%\usepackage[charter]{mathdesign}
% \def\rmdefault{bch} % not scaled
% \def\ttdefault{blg}
\usepackage{filecontents,ragged2e}
\makeatletter
%% decide on fonts
\IfFileExists{ifxetex.sty}{%
  \RequirePackage{ifxetex}}{}
  \ifxetex
     \usepackage{fontspec}
     \defaultfontfeatures{Mapping=tex-text}
     \setmainfont{Minion Pro}
     %\setsansfont{Georgia}
  \else
     \usepackage{mathpazo}
     \usepackage[T1]{fontenc}
  \fi


% Define some shortcut macros for error/warning/info logging.

\newcommand{\athenawarning}[1]{\PackageWarning{athena}{#1}}
\athenawarning{We are starting on an adventure!}
%

%\usetikzlibrary{decorations.markings}
%\usepackage{doc}
%\usetikzlibrary{calc} 
\usetikzlibrary{decorations,decorations.shapes,shapes,fadings,patterns}
     % We need lots of libraries...
        \usetikzlibrary{
          arrows,
          calc,
          fit,
          patterns,
          plotmarks,
          shapes.geometric,
          shapes.misc,
          shapes.symbols,
          shapes.arrows,
          shapes.callouts,
          shapes.multipart,
          shapes.gates.logic.US,
          shapes.gates.logic.IEC,
          circuits.logic.US,
          circuits.logic.IEC,
          circuits.logic.CDH,
          circuits.ee.IEC,
          datavisualization,
          datavisualization.formats.functions,
          er,
          automata,
          backgrounds,
          chains,
          topaths,
          trees,
          petri,
          mindmap,
          matrix,
          calendar,
          folding,
          fadings,
          shadings,
          spy,
          through,
          turtle,
          positioning,
          scopes,
          decorations.fractals,
          decorations.shapes,
          decorations.text,
          decorations.pathmorphing,
          decorations.pathreplacing,
          decorations.footprints,
          decorations.markings,
          shadows,
          lindenmayersystems,
          intersections,
          fixedpointarithmetic,
          fpu,
          svg.path,
          external,
        }



\definecolor{theblue} {rgb}{0.02,0.04,0.48}
\definecolor{thered}  {rgb}{0.65,0.04,0.07}
\definecolor{thegreen}{rgb}{0.06,0.44,0.08}
\definecolor{thelightgreen}{rgb}{0.06,0.44,0.06}
\definecolor{thegrey} {gray}{0.5}
\definecolor{thegray} {gray}{0.5}
\definecolor{thedarkgray} {gray}{0.95}
\definecolor{theshade}{gray}{0.94}
\definecolor{theframe}{gray}{0.75}
\definecolor{thecream}{rgb}{1,0.95,0.4}
\definecolor{spot}{rgb}{0,0.2,0.6}
\definecolor{boxframe}{gray}{0.8}
\definecolor{boxfill}{rgb}{0.95,0.95,0.99}
\definecolor{theoption}{rgb}{0.118,0.546,0.222}
\definecolor{themacro}{rgb}{0.784,0.06,0.176}
\definecolor{ExampleFrame}{rgb}{0.628,0.705,0.942}
\definecolor{ExampleBack}{rgb}{0.963,0.971,0.994}
\definecolor{Hyperlink}{rgb}{0.281,0.275,0.485}
\colorlet{thehyperlink}{theblue}
\newcommand*{\defaultcolor}{\color{black}}
\newcommand*{\spotcolor}{\color{spot}}

\newcommand\lorem{Fusce adipiscing justo nec ante. Nullam in enim.
 Pellentesque felis orci, sagittis ac, malesuada et, facilisis in,
 ligula. Nunc non magna sit amet mi aliquam dictum. In mi. Curabitur
 sollicitudin justo sed quam et quadd. \par}
%http://tex.stackexchange.com/questions/41150/background-baseline-grid-with-output-routine

\iffalse
\AddToShipoutPicture{%
    \begin{tikzpicture}[overlay,remember picture]
        \draw[thick,red]
              (current page.north east)
              rectangle (current page.south west);
        \draw[red!30!white,thin]
             (current page.south west) grid[step=2mm]
             (current page.north east);
        \draw[red!30!white,dotted]
             (current page.south west) grid[step=1cm]
             (current page.north east);
    \end{tikzpicture}%
}
\fi

\lstloadlanguages{[LaTeX]TeX, [primitive]TeX}

% Emphasis
\newcommand\emphasis[2][thered]{\lstset{emph={newcommand,def,gdef,#2},
   emphstyle={\bfseries\ttfamily\textcolor{#1}}}}%

\lstset{language={[LaTeX]TeX},
      escapeinside={{(*@}{@*)}}, 
       numbers=left, gobble=0,
       stepnumber=1,numbersep=5pt, 
       numberstyle={\footnotesize\color{gray}},firstnumber=10,
       breaklines=true,
       framesep=5pt,
       basicstyle=\small\ttfamily,
       showstringspaces=false,
      keywordstyle=\bfseries\ttfamily\textcolor{thegreen},
      stringstyle=\color{orange},
      commentstyle=\color{black},
      rulecolor=\color{theshade},
      breakatwhitespace=true,
     showspaces=false,  % shows spacing symbol
      xleftmargin=0pt,
      xrightmargin=5pt,
      aboveskip=3pt plus1pt minus1pt, % compact the code looks ugly in type
      belowskip=7pt plus1pt minus1pt,  % user responsible to insert any skips
      backgroundcolor=\color{theshade}
}

\graphicspath{{chapters/}{images/}}

\begin{filecontents*}{chapterx.sty}
\ProvidesPackage{chaptersx}[2012/04/07 v0.1 Typesetting chapters]

\def\HUGE{\@setfontsize\Huge{38}{47}}
\def\HHUGE{\@setfontsize\HHUGE{58}{67}}


\def\@words@cx#1{%
  \ifcase#1 zero\or one\or two\or three\or four\or five\or six\or seven\or eight\or nine\or ten\or
   eleven\or twelve\or thirteen\or fourteen\or fifteen\or sixteen\or seventeen\or eighteen\or nineteen \or twenty\or twenty one\or twenty two\or twenty three\or twenty four\or twenty five\or twenty six\or twenty seven \or twenty eight \or twenty nine\or thirty\or thirty one\or thirty two\or thirty three\or thirty four\or thirty five\or thirty six\or thirty seven\or thirty eight\or thirty nine\or forty\or forty one\or forty two \or forty three\or forty four\or forty five \or forty six \or forty seven\or forty eight \or forty nine\or fifty\or fifty on\or fifty two\or fifty three\or fifty four\or fifty five\or fifty six\or fifty seven\or fifty eight\or fifty nine\or sixty \or sixty one \or sixty two
\or sixty three \or sixty four \or \sixty five\else\@ctrerr\fi}



\newenvironment{absquote}
               {\list{}{\leftmargin2cm\rightmargin\leftmargin}%
                \item\relax\footnotesize}
               {\endlist}

\newenvironment{summary}
               {\list{}{\listparindent0pt %
                        \itemindent\listparindent
                        \leftmargin0pt
                        \rightmargin\leftmargin
                        \parsep\z@ \@plus\p@}%
                \item\relax\itshape}
               {\endlist}


% helper macros for rulers
\gdef\thinrule{\rule{\textwidth}{0.4pt}}
\gdef\mediumrule{\rule{\textwidth}{0.8pt}}
\def\thickrule{\leavevmode \leaders \hrule height 3pt \hfill \kern \z@}


%% broad positions
\newif\if@left
\newif\if@right
\newif\if@center
\@leftfalse
\@rightfalse
\@centerfalse
% newifs for number position
\newif\if@lefttitle
\newif\if@righttitle
\newif\if@leftname
\newif\if@rightname
\newif\if@chapterspaceout\@chapterspaceoutfalse
\newif\if@titlespaceout\@chapterspaceoutfalse
\newif\if@sectionspaceout\@sectionspaceoutfalse
\newif\if@openanywhere\@openanywherefalse
%% The chapter command does not allow for openleft pages which we need
%% for some of the designs. 
\newif\if@openleft\@openleftfalse
\newif\if@openany\@openanyfalse
%
% Switch to indicate if an item should be added to the toc or not.
\newif\if@toc  \@toctrue
\newif\if@tocimage \@tocimagefalse

% Boolean set to true if a chapter head includes an author block
\newif\if@authorblock

%
%
\def\cx@optionlist{}


\def\cx@optionlist{}

\def\cxuselibrary#1{\cxset{library/.cd,#1}}
%
% The library is added by inputting the file and setting the path accordingly.
\def\cx@add@library#1#2{%
  \cxset{library/#1/.code={\@ifundefined{cxlibrary@#1@loaded}{\input #2}{}}}%
  \DeclareOption{#1}{\edef\cx@optionlist{\cx@optionlist,#1}}%
}

% Process options need to add




% Keys for styling chapters
% Define a family for chapter styling keys
\pgfkeys{/chapter/.is family}


\def\cxset{\pgfqkeys{/chapter}} %Notice this is pgf q keys


\cxset{%
  name/.code={\gdef\chaptername{#1}},
  chapter name/.code={\gdef\chaptername{#1}},
  color/.store in=\color@cx,
  color/.default=black,
  chapter opening/.is choice,
  chapter opening/right/.code={\@openrighttrue},
  chapter opening/left/.code={\@openlefttrue},
  chapter opening/any/.code={\@openanytrue},
  chapter opening/none/.code={\@openanywheretrue\@openrightfalse
                                              \@openleftfalse\@openanyfalse},
  chapter opening/anywhere/.code={\@openanywheretrue\@openrightfalse
\@openleftfalse\@openanyfalse},
  chapter opening/ifafter/.code={}, %still to come with pagesofar
  chapter font-family/.store in=\chapterfontfamily@cx,
  chapter font-weight/.store in=\chapterfontweight@cx,
  chapter font-size/.store in=\chapterfontsize@cx,
  chapter color/.store in=\chaptercolor@cx,
  chapter before/.store in=\chapterbefore@cx,
  chapter after/.store in=\chapterafter@cx,
  chapter spaceout/.is choice,
  chapter spaceout/soul/.code={\@chapterspaceouttrue},
  chapter spaceout/none/.code={\@chapterspaceoutfalse},
  % title keys
  title font-family/.store in=\titlefontfamily@cx,
  title font-family/.default=\rmfamily,
  title font-weight/.store in=\titlefontweight@cx,
  title font-size/.store in=\titlefontsize@cx,
  title font-color/.store in=\titlefontcolor@cx,
  title font-shape/.store in= \titlefontshape@cx,
  title spaceout/.is choice,
  title spaceout/soul/.code={\@titlespaceouttrue},
  title spaceout/none/.code={\@titlespaceoutfalse},
  title font/.style={title font-family=#1},
  title before/.store in=\titlebefore@cx,
  title after/.store in=\titleafter@cx,
  title beforeskip/.store in=\titlebeforeskip@cx,
  title afterskip/.store in=\titleafterskip@cx,
  position/.is choice,
  position/left/.code={\@lefttrue},
  position/right/.code={\@righttrue},
  position/center/.code={\@centertrue},
% numbering options that are required
  numbering/.is choice,
% better to rename thechapter?
  numbering/roman/.code={\gdef\thechapter{\@roman\c@chapter}},
  numbering/Roman/.code={\gdef\thechapter{\@Roman\c@chapter}},
  numbering/arabic/.code={\gdef\thechapter{\@arabic\c@chapter}},
  numbering/alpha/.code={\gdef\thechapter{\alphalph\c@chapter}},
  numbering/Alpha/.code={\gdef\thechapter{\AlphAlph\c@chapter}},
  numbering/words/.code={\gdef\thechapter{\MakeTextLowercase{\expandafter\@words@cx{\expandafter\@arabic\c@chapter}}}},
%% These proved a bit trouble some and ended up calling the fmtcount package routines
  numbering/WORDS/.code={\gdef\thechapter{\NUMBERstring{chapter}}},
  numbering/Words/.code={\gdef\thechapter{\NumToName{\expandafter\@arabic\c@chapter}}},
%% These is for my own use for EJD type numbering, placed in an mbox as there is something funny
% happening with spaces.
  numbering/padzeroes/.code={\gdef\thechapter{\mbox{EWD -\padzeroes[4]\decimal{chapter}}%
  }%
 },
  numbering/none/.code={\gdef\thechapter{}}, % do not leave empty gives other problems??? 
  number dot/.store in=\numberpunctuation@cx,
  number position/.is choice,
  number position/leftname/.code={\@leftnametrue\@rightnamefalse},
  number position/rightname/.code={\@rightnametrue\@leftnamefalse},
  number position/absolute/.code={},
  number position/righttitle/.code={\@righttitletrue},
  number position/lefttitle/.code={\@lefttitletrue},
  number after/.store in=\numberafter@cx,
  number before/.store in=\numberbefore@cx,
  number color/.store in=\numbercolor@cx,
  number font-size/.store in=\numberfontsize@cx,
  number font-family/.store in=\numberfontfamily@cx,
  number font-weight/.store in=\numberfontweight@cx,
% authorblock
  author block/.is choice,
  author block/true/.code={\@authorblocktrue},
  author block/false/.code={\@authorblockfalse},
  author names/.store in=\authorblock@cx,  
  author block format/.store in=\authorblockformat@cx,
  chapter toc/.is choice,
  chapter toc/true/.code=\@toctrue\cxset{numbering=arabic,name=Chapter},
  chapter toc/false/.code=\@tocfalse,
  chapter toc/none/.code=\@tocfalse,
% sectioning commands
  section font-size/.store in=\sectionfontsize@cx,
  section font-weight/.store in=\sectionfontweight@cx,
  section font-family/.store in=\sectionfontfamily@cx,
  section font-shape/.store in=\sectionfontshape@cx,
  section color/.store in=\sectioncolor@cx,
  section numbering/.is choice,
  section numbering/roman/.code={\gdef\thesection{\thechapter\@roman\c@section}\renewsection},
  section numbering/(roman)/.code={\gdef\thesection{\thechapter(\@roman\c@section)}\renewsection},
  section numbering/arabic/.code={\gdef\thesection{\thechapter.\@arabic\c@section}\renewsection},
  section numbering/numeric/.code={\gdef\thesection{\thechapter.\@arabic\c@section}\renewsection},
  section numbering custom/.code=\gdef\thesection{#1}\renewsection,
  section numbering/none/.code={\gdef\thesection{}\renewsection},
  section align/.store in=\sectionalign@cx,
  section beforeskip/.store in=\sectionbeforeskip@cx,
  section afterskip/.store in=\sectionafterskip@cx,
  section indent/.store in=\sectionindent@cx,
  section spaceout/.is choice,
  section spaceout/soul/.code={\@sectionspaceouttrue},
  section spaceout/none/.code={\@sectionspaceoutfalse},
% subsections
  subsection font-size/.store in=\subsectionfontsize@cx,
  subsection font-weight/.store in=\subsectionfontweight@cx,
  subsection font-family/.store in=\subsectionfontfamily@cx,
  subsection font-shape/.store in=\subsectionfontshape@cx,
  subsection color/.store in=\subsectioncolor@cx,
  subsection numbering/.is choice,
  subsection numbering/arabic/.code={\gdef\thesubsection{\thesection.\@arabic\c@subsection}},
  subsection numbering/custom/.store in=\thesubsection@cx,
  subsection numbering/none/.code={\gdef\thesubsection{}},
  subsection align/.store in=\subsectionalign@cx,
  subsection beforeskip/.store in=\subsectionbeforeskip@cx,
  subsection afterskip/.store in=\subsectionafterskip@cx,
  subsection indent/.store in=\subsectionindent@cx,
%%
%% subsubsection
  subsubsection font-size/.store in=\subsubsectionfontsize@cx,
  subsubsection font-weight/.store in=\subsubsectionfontweight@cx,
  subsubsection font-family/.store in=\subsubsectionfontfamily@cx,
  subsubsection font-shape/.store in=\subsubsectionfontshape@cx,
  subsubsection color/.store in=\subsubsectioncolor@cx,
  subsubsection numbering/.is choice,
  subsubsection numbering/numeric/.code={\gdef\thesubsubsection{\thesubsection.\@arabic\c@subsubsection}},
  subsubsection numbering/custom/.store in=\thesubsubsection@cx,
  subsubsection numbering/none/.code={\gdef\thesubsubsection{}},
  subsubsection align/.store in=\subsubsectionalign@cx,
  subsubsection beforeskip/.store in=\subsubsectionbeforeskip@cx,
  subsubsection afterskip/.store in=\subsubsectionafterskip@cx,
  subsubsection indent/.store in=\subsubsectionindent@cx,
%
% paragraph
%
  paragraph font-size/.store in=\paragraphfontsize@cx,
  paragraph font-weight/.store in=\paragraphfontweight@cx,
  paragraph font-family/.store in=\paragraphfontfamily@cx,
  paragraph font-shape/.store in=\paragraphfontshape@cx,
  paragraph color/.store in=\paragraphcolor@cx,
  paragraph numbering/.is choice,
  paragraph numbering/numeric/.code={\gdef\theparagraph{\thesubsubsection.\@arabic\c@paragraph}},
  paragraph numbering/custom/.store in=\theparagraph@cx,
  paragraph numbering/none/.code={\gdef\theparagraph{}},
  paragraph align/.store in=\paragraphalign@cx,
  paragraph beforeskip/.store in=\paragraphbeforeskip@cx,
  paragraph afterskip/.store in=\paragraphafterskip@cx,
  paragraph indent/.store in=\paragraphindent@cx,
%% subparagraphs
%
  subparagraph font-size/.store in=\subparagraphfontsize@cx,
  subparagraph font-weight/.store in=\subparagraphfontweight@cx,
  subparagraph font-family/.store in=\subparagraphfontfamily@cx,
  subparagraph font-shape/.store in=\subparagraphfontshape@cx,
  subparagraph color/.store in=\subparagraphcolor@cx,
  subparagraph numbering/.is choice,
  subparagraph numbering/numeric/.code={\gdef\thesubparagraph{\theparagraph.\@arabic\c@subparagraph}},
  subparagraph numbering/arabic/.code={\gdef\thesubparagraph{\theparagraph.\@arabic\c@subparagraph}}
  subparagraph numbering/custom/.store in=\thesubparagraph@cx,
  subparagraph numbering/none/.code={\gdef\thesubparagraph{}},
  subparagraph align/.store in=\subparagraphalign@cx,
  subparagraph beforeskip/.store in=\subparagraphbeforeskip@cx,
  subparagraph afterskip/.store in=\subparagraphafterskip@cx,
  subparagraph indent/.store in=\subparagraphindent@cx,
  subparagraph number after/.estore in=\subparagraphnumberafter@cx,
  subparagraph number after/.default=,
  subparagraph number after/.initial=,
%
%% headers and footers
  header style/.store in=\headerstyle@cx,
% general draft rules
  rule /.is choice,
  rule on/.code={\gdef\rulewidth@cx{0.4pt}},
  rule off/.code={\gdef\rulewidth@cx{0pt}},
% headers and footers
  lhead/.code ={\lhead{#1}},
  rhead/.code={\rhead{#1}},
  chead/.code={\chead{#1}},
  lfoot/.code ={\lhead{#1}},
  cfoot/.code={\chead{#1}},
  rfoot/.code={\rhead{#1}},
  headrulewidth/.code={\renewcommand\headrulewidth{#1}},
  footrulewidth/.code={\renewcommand\footrulewidth{#1}},
}



%% Commands to renew sectioning, these unfortunately need to be 
%% called explicitly
\def\renewsection{%
\renewcommand\section{%
\@startsection{section}%
{1}%level
{\sectionindent@cx}%indent
{\sectionbeforeskip@cx}%
{\sectionafterskip@cx}%
{\sectionfontweight@cx\sectionfontfamily@cx%
\sectionfontsize@cx\sectionfontshape@cx\sectionalign@cx}%
}%
}

\def\renewsubsection{%
\renewcommand\subsection{%
 \@startsection{subsection}%
{2}%level
{\subsectionindent@cx}%indent
{\subsectionbeforeskip@cx}%
{\subsectionafterskip@cx}%
{\subsectionfontweight@cx\subsectionfontfamily@cx\subsectionfontshape@cx%
 \subsectionfontsize@cx\color{\subsectioncolor@cx}\subsectionalign@cx}%
}%
}



\def\renewsubsubsection{%
\renewcommand\subsubsection{%
 \@startsection{subsubsection}%
{3}%level
{\subsubsectionindent@cx}%indent
{\subsubsectionbeforeskip@cx}%
{\subsubsectionafterskip@cx}%
{\subsubsectionfontweight@cx\subsubsectionfontfamily@cx%
\subsubsectionfontsize@cx\subsubsectionfontshape@cx\subsubsectionalign@cx}%
}}

\def\renewparagraph{%
\renewcommand\paragraph{%
 \@startsection{paragraph}%
{4}%level
{\paragraphindent@cx}%indent
{\paragraphbeforeskip@cx}%
{\paragraphafterskip@cx}%
{\paragraphfontweight@cx\paragraphfontfamily@cx%
\paragraphfontsize@cx\paragraphfontshape@cx\paragraphalign@cx}%
}}

\def\renewsubparagraph{%
\renewcommand\subparagraph{%
 \@startsection{subparagraph}%
{5}%level
{\subparagraphindent@cx}%indent
{\subparagraphbeforeskip@cx}%
{\subparagraphafterskip@cx}%
{\subparagraphfontweight@cx\subparagraphfontfamily@cx%
\subparagraphfontsize@cx\subparagraphfontshape@cx\subparagraphalign@cx}%
}%
\def\@seccntformat##1{\csname the##1\endcsname\subparagraphnumberafter@cx}%
}

% set some defaults

\cxset{%
  lhead=left head text,
  chead=center text,
  rhead=right text,
  lfoot=left text,
  cfoot=center text,
  rfoot=right text,
  headrulewidth=2pt,
  footrulewidth=0.4pt,
  color=blue,
  position=center,
  name=chapteris,
  title font-family=\rmfamily,
  title font-weight=\bfseries,
  title font-size=\Huge,
  title font-color=\color{olive},
  numbering=arabic,
  number dot=,
  chapter font-family=\sffamily,
  chapter font-weight=\bfseries,
  chapter font-size=\Large,
  chapter color=gray,
  chapter before={\leavevmode\par\hfill},%need to correct for 0pt
  chapter after=\hfill\hfill,
  number position=rightname,
  number color=\color{gray},
  number after=\hspace{20pt},
  number before=\hspace*{20pt},
  number font-size=\huge,
  number font-family=\sffamily,
  number font-weight=\bfseries,
  number before=,
  number after=,
  title before=,
  title after=,
  title afterskip={\vskip50pt},
  title beforeskip={\vskip10pt},
  header style=fancy,
}



\gdef\setdefaults{%
\cxset{%
  lhead=left head text,
  chead=center text,
  rhead=right text,
  lfoot=left text,
  cfoot=center text,
  rfoot=right text,
name=CHAPTER,
title font-family=\rmfamily,
title font-weight=\bfseries,
title font-size=\Huge,
title font-color=\color{purple},
numbering=arabic,
number dot=,
number before=,
number after=,
chapter font-family=\sffamily,
chapter font-weight=\bfseries,
chapter font-size=\large,
chapter spaceout=soul,
chapter color=gray,
chapter before={},%need to correct for 0pt
chapter after=,
number position=rightname,
number color=\color{gray},
number after=\hspace{20pt},
number before=\space,
number font-size=\large,
number font-family=\sffamily,
number font-weight=\bfseries,
title before=,
title after=,
title afterskip={\vskip24pt},
title beforeskip={\vskip10pt},
title font=\rmfamily,
header style=plain,
section font-weight=\bfseries,
section font-family=\rmfamily,
section font-size=\Large,
section font-shape=\upshape,
section align=\raggedright,
title font-shape=\upshape,
subsection color=teal,
}
}

%% STYLE 13
\cxset{style13/.style={
 name={Chapter},
 numbering=arabic,
 number font-size=\HUGE,
 number font-family=\sffamily,
 number font-weight=\bfseries,
 number color=\color{gray!50},
 number before=\par\vspace*{5pt}\hfill\hfill,
 number dot=,
 number after={\hspace*{7pt}\par},
 number position=rightname,
 chapter font-family=\sffamily,
 chapter font-weight=\normalfont,
 chapter font-size=\LARGE,
 chapter before={\thinrule\vspace*{20pt}\par\hfill\hfill},
 chapter after={\vskip0pt\par},
 chapter color={black!50},
 title beforeskip={\vspace*{10pt}},
 title afterskip={\vspace*{50pt}\par},
 title before={\hfill\hfill\raggedleft},
 title after={},
 title font-family=\sffamily,
 title font-color=\color{purple},
 title font-weight=\bfseries,
 title font-size=\huge,
 section indent=-1em,
 section align=\raggedright,
 section numbering=arabic,
 section indent=0pt,
 section beforeskip=0pt,
 section afterskip=\baselineskip,
 subsection align=\raggedright,
 subsection font-family=\sffamily,
 subsection font-weight=\bfseries,
 subsection font-size=\large,
 subsection font-shape=\itshape,
 subparagraph number after=\space,
}
}



% The |\@makechapterhead| is used by LaTeX to typeset the
% Chapter heading. This is a rewrite in order to make it
% more flexible and use the keys.
% #1 spare
% #2 title
\newif\if@special\@specialfalse
\cxset{custom/.code=\gdef\customdesign@cx{\csname#1\endcsname}\@specialtrue,
       fill/.store in=\fill@cx}
\cxset{custom=tikzspecial,
    title font-size=\Large,
    title font-color=\color{white},
    title font-family=\sffamily,
    fill=thegrey,
}

% Helper macro for use with the makechapterheadmacro
\def\printnumber{%% macro for typesetting the chapter number
    \numberbefore@cx
      {%
      \numberfontweight@cx
      \numbercolor@cx
      \numberfontsize@cx
      \numberfontfamily@cx
      \thechapter
      \numberpunctuation@cx
      }
      \numberafter@cx
  }


\renewcommand\@makechapterhead[2][]{%
% The special switch triggers the special macro that format the head
% this is used for TikZ designs etc.
\if@special
    \customdesign@cx{#2}
   \else
  %
% macro for typesetting the chapter name
  \def\printchaptername{%
    {
    \chapterfontfamily@cx
    \chapterfontsize@cx
    \chapterfontweight@cx
    \color{\chaptercolor@cx}%
% Check if the chapter name is spaced out and use the
% soul package. TODO add values for soul parameters
% as a style feature.
    \if@chapterspaceout 
     \expandafter\so\expandafter{\chaptername}
    \else
      \@chapapp\space
    \fi
    }%
  }%
  \def\printauthorblock{
      \authorblockformat@cx\authorblock@cx%
  }%
% set all keys
    {%
    \parindent0pt 
    \normalfont%
    \ifnum \c@secnumdepth>\m@ne%
      \if@mainmatter%
 % we start displaying  the names and any preambles such 
 % as images
 % print chapter name
         \chapterbefore@cx%
         \if@leftname
            \printnumber
         \fi%
         \printchaptername
         \if@rightname
            \printnumber
         \fi%
         \chapterafter@cx  
      \fi%
    \fi%
     %chapter title
    \interlinepenalty\@M%
% if the number is before the title
% if the number prints together with the title they 
% are considered as one indivisible part.
     \titlebeforeskip@cx%
     \if@lefttitle%
       \beforenumber@cx%
       \counterdisplay\c@chapter\afternumber@cx%
     \fi
% Display title
       \titlefontweight@cx
      \titlefontfamily@cx
      \titlefontshape@cx
      \titlefontsize@cx
      \titlefontcolor@cx
      \selectfont
      \titlebefore@cx%
      \if@titlespaceout
         \so{#2}%
      \else
         \texorpdfstring{#2}%title
      \fi%
      \titleafter@cx
    \if@righttitle%
      \afternumber@cx
      \counterdisplay\c@chapter\afternumber@cx%
    \fi
% If there is an author block format it and print it
    \if@authorblock\printauthorblock\fi%
    \par\nobreak%
% skip after title
    \titleafterskip@cx
% headers
   }
\fi
}


%% Special Chapter command. This one just typesets a picture on top of a 
%% Chapter head
\newcommand\specialchapter@cx[2][]{%
\refstepcounter{chapter}
\cxset{image/.store in=\image@cx,
       image caption/.store in=\caption@cx}
\cxset{#1}
\vbox to 0pt{\color{blue}\rule{\paperwidth}{0.4pt}\par\vskip-1.4pt
\rule{0.4pt}{\textheight}\rule{4cm}{0.4pt}}

\vbox to 0pt{\parbox[b]{4.7cm}{%
\raggedright

\leftskip1.5cm
\caption@cx\par
 \expandafter\rule{\rulewidth@cx}{5.8cm}
}\parbox[b]{0.5cm}{\includegraphics[width=0.5cm,height=9.15cm]{./chapters/shadow}}\includegraphics{./chapters/\image@cx}\par}

\vspace{8.2cm}
\hspace*{-3.51cm}\hbox to 0pt{\hspace*{1.01cm}\includegraphics[width=7.7cm,height=3.8cm]{./chapters/genetics-band}
\hspace*{-2.7cm}\sffamily\color{\numbercolor@cx}\HHUGE \raise30pt\hbox{\thechapter}%
\hspace{1.5cm}\raise0.5pt\hbox{\includegraphics{./chapters/chapterconcept}\includegraphics{./chapters/shadow2}}
}

%% Title name
\parbox[b]{0.45\textwidth}{%
  \titlefontsize@cx
  \titlefontweight@cx
  \titlefontfamily@cx
  \leftskip0.5em \color{\titlefontcolor@cx}
  #2
}
%% Concepts
}

\newenvironment{specialchapter}[2][]{%
  \if@openright\cleardoublepage\else\clearpage\fi
    \thispagestyle{plain}%
    \global\@topnum\z@
    \@afterindentfalse
    \specialchapter@cx[#1]{#2}
    \begin{minipage}{0.5\textwidth}%
    \vspace{0.5\baselineskip}
    \raggedright
}{\end{minipage}}

%% Utility command
\providecommand{\cleartoevenpage}[1][\@empty]{%
 \clearpage%
 \ifodd\c@page\hbox{}#1\clearpage\fi}

\end{filecontents*}
\usepackage{fancyhdr}
\usepackage{chapterx}
\usepackage{makeidx}
\makeindex
\author{Y Lazarides}
\title{\parindent0pt A New Approach in\\ Styling Chapters}

\usepackage{textcase}

%% bibliography related
\usepackage[american]{babel}
\usepackage{csquotes}
\usepackage[style=authoryear]{biblatex}

% set-up the hyperef package properly
\usepackage{hyperref}
\hypersetup{%
  colorlinks=true,
  linkcolor=DarkBlue,
  pagecolor=DarkBlue,
  urlcolor=spot,
  bookmarks=true,
  bookmarksopen=true,
  bookmarksnumbered=false,
  plainpages=false,
  pdfpagemode=UseOutlines,
  pdfview=FitH,
  pdfstartview=FitH}

\addbibresource{biblatex-examples.bib}
\setlength{\parindent}{0pt}

% Some generic settings
\def\cmd#1{\texttt{\textbackslash #1}}

\def\file#1{\protect\texttt{\textbackslash #1}}


\newenvironment{bibsample}
  {\trivlist\samepage
   \setlength{\itemsep}{0pt}}
  {\endtrivlist}

%% doccommands
\newcommand*{\marglistfont}{\itshape}
\newcommand*{\margnotefont}{}
\newcommand*{\optionlistfont}{\bfseries}
\newcommand*{\ltxsyntaxfont}{\ttfamily}
\newcommand*{\ltxsyntaxlabelfont}{\bfseries}
\newcommand*{\changelogfont}{\normalfont}
\newcommand*{\changeloglabelfont}{\bfseries}
\newcommand*{\verbatimfont}{\ttfamily}
\newcommand*{\displayverbfont}{\ttfamily}
\renewcommand*{\verbatim@font}{\verbatimfont}
\renewrobustcmd*{\cmd}[1]{\mbox{\verbatimfont\bfseries\textbackslash#1}}
\newrobustcmd*{\env}[1]{\mbox{\verbatimfont\bfseries\textcolor{thegreen}{#1}}}
\newrobustcmd*{\len}[1]{\mbox{\verbatimfont\textbackslash#1}}
\newrobustcmd*{\cnt}[1]{\mbox{\verbatimfont#1}}
\newlength{\marglistsep}
\newlength{\marglistwidth}
\setlength{\marglistwidth}{(\oddsidemargin+1in)*85/100}%
\deflength{\marglistsep}{10pt}
%% This needs thorough checking as to restore previous definitions
%% of parsep we want parsep to be a bit higher than standard enumerated lists.
\global\newlength\oldparsep
\newenvironment*{marglist}
  {\setlength\oldparsep{\parsep}\list{}{%
     \parsep 3.5\p@ \@plus0\p@ \@minus\p@
     \setlength{\labelwidth}{\marglistwidth}%
     \setlength{\labelsep}{\marglistsep}%
     \setlength{\leftmargin}{0pt}%
     \renewcommand*{\makelabel}[1]{\hss\marglistfont##1}}}
  {\endlist\setlength\parsep{\oldparsep}}

\newenvironment*{keymarglist}
  {\marglist
   \setlength{\itemsep}{0pt}%
   \raggedright}
  {\endmarglist}

%% DOCUMENTATION MACROS



% color definitions
\def\colDef#1{\textcolor{themacro}{#1}}
% color for options
\def\colOpt#1{\textcolor{theblue}{#1}}
\newcommand{\option}[1]{\colOpt{#1}}

% The following macros are taken from ltxdoc
 \ifx\l@nohyphenation\undefined
   \newlanguage\l@nohyphenation
 \fi
 \DeclareRobustCommand\meta[1]{%
%Since the old implementation of \meta could be used in math we better ensure
%that this is possible with the new one as well. So we use \ensuremath around
%\langle and \rangle. However this is not enough: if \meta@font@select below
%expands to \itshape it will fail if used in math mode. For this reason we hide
%the whole thing inside an \nfss@text box in that case.
 \ensuremath\langle
 \ifmmode \expandafter \nfss@text \fi
 {%
 \meta@font@select
%Need to keep track of what we changed just in case the user changes font inside
%the argument so we store the font explicitly.
 \edef\meta@hyphen@restore
 {\hyphenchar\the\font\the\hyphenchar\font}%
 \hyphenchar\font\m@ne
 \language\l@nohyphenation
 #1\/%
 \meta@hyphen@restore
 }\ensuremath\rangle
}
\def\meta@font@select{\itshape}
\def\cmd#1{\cs{\expandafter\cmd@to@cs\string#1}}
\def\cmd@to@cs#1#2{\char\number`#2\relax}

%%% stop error
% \newrobustcmd*{\cs}[1]{\mbox{\verbatimfont\bfseries\textbackslash#1}}
% This documentation macro is defined in a few places check if undefined and act accordingly
% override everything
\ifx\cs\undefined
\DeclareRobustCommand\cs[1]{{\color{themacro}\bfseries\verbatimfont\char`\\#1}%
  \index{macros!\textbackslash#1}}%
\else
  \let\cs\relax
  \DeclareRobustCommand\cs[1]{{\color{themacro}\bfseries\verbatimfont\char`\\#1}%
  \index{macros!\textbackslash#1}}
\fi


%
\def\marg#1{%
  {\ttfamily\char`\{}\meta{#1}{\ttfamily\char`\}}}


\def\oarg#1{%
  \colOpt{{\ttfamily[}\meta{#1}{\ttfamily]}}}

\def\pkg#1{\textbf{#1}}
\tcbset{after=\medskip,before=\bigskip}


% Many of the chapter styles we provide have epigraphs incorporated. We
% provide the necessary keys to set parameters. We follow terminology from
% the original package.

\RequirePackage{epigraph}
\makeatletter
\cxset{
  epigraph width/.code={\setlength\epigraphwidth{#1}},
  epigraph font-size/.code={\renewcommand{\epigraphsize}{#1}},
  epigraph beforeskip/.code={\setlength\beforeepigraphskip{#1}},
  epigraph afterskip/.code={\setlength\afterepigraphskip{#1}},
  epigraph align/.is choice,
  epigraph align/center/.code={\renewcommand{\epigraphflush}{center}},
  epigraph align/left/.code={\renewcommand{\epigraphflush}{flushleft}},
  epigraph align/right/.code={\renewcommand{\epigraphflush}{flushright}},
  epigraph source align/.is choice,
  epigraph source align/left/.code={\renewcommand{\sourceflush}{flushleft}},
  epigraph source align/right/.code={\renewcommand{\sourceflush}{flushright}},
  epigraph source align/center/.code={\renewcommand{\sourceflush}{center}},
  epigraph text align/.is choice,
  epigraph text align/left/.code={\renewcommand{\textflush}{flushleft}},
  epigraph text align/right/.code={\renewcommand{\textflush}{flushright}},
  epigraph text align/center/.code={\renewcommand{\textflush}{center}},
  epigraph rule width/.code={\setlength\epigraphrule{#1}},
  epigraph rule/.code={\renewcommand{\@epirule}{\color{orange}\rule[.5ex]{\epigraphwidth}{\epigraphrule}}},
}

\cxset{epigraph width=0.5\linewidth,
       epigraph font-size=\small,
       epigraph rule width=0.4pt,
       epigraph align=right,
       epigraph source align=right,
       epigraph text align=right,
       epigraph rule}

\parindent1em

% documentation macro
\newlength\temp@cx

% \begin{macro}
%    \begin{macrocode}
\long\def\keyval#1#2#3{%
\begingroup
\settowidth\temp@cx{#1}%
\parindent-30pt%\dimexpr\temp@cx+10pt\relax%
\par\leavevmode%
{\color{theblue}\bfseries #1}\thinspace=\thinspace#2 #3%
\par\addvspace{1.5pt}
\endgroup
}
%    \end{macrocode}
% \end{macro}

\newif\if@latexbook
\@latexbookfalse

\if@latexbook
\renewcommand\chapter{\if@openright\cleardoublepage\else\clearpage\fi
                    \thispagestyle{plain}%
%    \end{macrocode}
%    Then we prevent floats from appearing at the top of this page
%    because it looks weird to see a floating object above a chapter
%    title.
%    \begin{macrocode}
                    \global\@topnum\z@
%    \end{macrocode}
%    Then we suppress the indentation of the first paragraph by
%    setting the switch |\@afterindent| to |false|. We use |\secdef|
%    to specify the macros to use for actually setting the chapter
%    title.
%    \begin{macrocode}
                    \@afterindentfalse
                    \secdef\@chapter\@schapter}

\else

%% It also defaults on a pagestyle which we also need to correct
\renewcommand\chapter{%
%  \if@latexbook \expandafter\latexbookchapter
%  \else
    \if@openright\cleardoublepage\fi
    \if@openleft\cleartoevenpage\fi
    \if@openany\clearpage\fi
%% we need to capture the running head keys
%% \headerstyle@cx defaults to empty
    \thispagestyle{\headerstyle@cx}%
    \global\@topnum\z@
    \@afterindentfalse
    \secdef\@chapter\@schapter%must disable \@schapter
 }
\fi


\def\@part[#1]#2{%
    \ifnum \c@secnumdepth >-2\relax
      \refstepcounter{part}%
      \addcontentsline{toc}{part}{\thepart\hspace{1em}#1}%
    \else
      \addcontentsline{toc}{part}{#1}%
    \fi
    \markboth{}{}%
    {\centering
     \interlinepenalty \@M
     \normalfont
     \ifnum \c@secnumdepth >-2\relax
       \huge\bfseries \partname\nobreakspace\thepart
       \par
       \vskip 20\p@
     \fi
     \Huge \bfseries #2\par}%
    \@endpart}


%% Adjusted to get toc parameters in
\DeclareRobustCommand\Rule{{\color{\tocchapternumberfill@cx}\rule[-4.1pt]{13cm}{0.4pt}}}

\def\@chapter[#1]#2{%
    \ifnum \c@secnumdepth >\m@ne
          \if@mainmatter
               \refstepcounter{chapter}%needs checking as to pos
            \if@toc
               \typeout{\@chapapp\space\thechapter.}%
% check if main matter and if toc is set
%             \addcontentsline{toc}{chapter}%
%                                   {\protect\numberline{\thechapter}#1}% might as well add image here
              \addcontentsline{toc}{chapter} {\protect\numberline{%
                                    \protect\colorbox{\protect\tocchapternumberfill@cx}%
                                        {\color{\tocchapternumbercolor@cx}\string\parbox{1.5em} {\protect\tocnumberalign@cx\thechapter\stoptocnumberalign@cx}}%
                   \Rule\kern-13cm\hspace{1em}\bfseries\sffamily}\protect\hspace*{1em}\bfseries#1}%Make Upper case
            \fi%
         \else
                \addcontentsline{toc}{chapter}{#1}%for part???
         \fi
     \else
             \addcontentsline{toc}{chapter}{#1}%????? for part
      \fi
             \chaptermark{#1}%
             \addtocontents{lof}{\protect\addvspace{10\p@}}%
             \addtocontents{lot}{\protect\addvspace{10\p@}}%
%              \if@twocolumn
%                      \@topnewpage[\@makechapterhead{#2}]%
%                \else
                     \@makechapterhead{#2}%
               \@afterheading
%             \fi
   }



% Table of contents key settings
\cxset{
  toc levels/.code={\setcounter{tocdepth}{#1}},
  toc number width/.code = {\def\@pnumwidth{#1}},
  toc chapter number color/.store in=\tocchapternumbercolor@cx,
  toc chapter number fill/.store in=\tocchapternumberfill@cx,
  toc chapter after/.store in=\tocchapterafter@cx,
  toc section indent/.store in=\tocsectionindent@cx,
  toc subsection indent/.store in=\tocsubsectionindent@cx,
  toc subsubsection indent/.store in=\tocsubsubsectionindent@cx,
  toc paragraph indent/.store in=\tocparagraphindent@cx,
  toc subparagraph indent/.store in=\tocsubparagraphindent@cx,
  toc section number width/.store in=\tocsectionnumberwidth@cx,
  toc dots/.is choice,
  toc dots/none/.code=\renewcommand\@dotsep{1000}, %set to high value
  toc dots/true/.code=\renewcommand\@dotsep{4.5},
  toc dotsep/.code=\renewcommand\@dotsep{#1},
%% toc title
  toc chapter name/.store in=\chaptername,
  toc chapter name color/.code=\gdef\tocchapternamecolor@cx{#1},
  toc title color/.store in=\toctitlecolor@cx,
  toc title font-weight/.store in=\toctitlefontweight@cx,
  toc title before/.store in=\toctitlebefore@cx,
  toc title after/.store in=\toctitleafter@cx,
  toc after pagenumber/.store in=\tocafterpagenumber@cx,
  toc right margin/.code=\renewcommand\@tocrmarg{#1},
  toc number after/.store in={\tocnumberafter@cx},
  toc number align/.is choice,
  toc number align/center/.code=\def\tocnumberalign@cx{\centering}\def\stoptocnumberalign@cx{},
  toc number align/left/.code=\def\tocnumberalign@cx{\centering}\def\stoptocnumberalign@cx{},
  toc number align/right/.code=\def\tocnumberalign@cx{\hfill}\def\stoptocnumberalign@cx{},
  toc image/.is if=@tocimage,
  hypersetup linkcolor/.store in=\hypersetuplinkcolor@cx,
}
 
%% SET TOC STYLING
\cxset{chapter toc=true, 
          toc number width=2.7em, 
          toc levels=5,
% Chapter
          toc chapter number color=black,
          toc chapter number fill=cyan,
          toc chapter after=20pt,
% Sectioning
          toc section indent=3.3em,
          toc subsection indent=5.9em,
          toc subsubsection indent=9.2em,
          toc subparagraph indent=9.2em,
          toc paragraph indent=9.2em,
          toc section number width=2.5em,
          toc dots=none,
          toc title font-weight=\bfseries,
          toc right margin=4cm,
          toc number after=\hspace{1em},
          toc title color=thegray,
          toc title font-weight=\fontfamily{ptm}\selectfont\bfseries ,
          toc title before=\hspace*{0.5em},
          toc title after=\hspace{32.2em},
          toc after pagenumber=,
          toc number align=center,
          toc image=true,
          hypersetup linkcolor=black,
          custom={},
  }

%\@dottedtocline{<level>}{<indent>}{<numwidth>}{<title>}{<page>}

%
%\renewcommand*\l@chapter[2]{%
%  %#1 number and title  #2 page number
%   \ifnum \c@tocdepth >\m@ne
%    \addpenalty{-\@highpenalty}%
%    \vskip 1.0em \@plus\p@
%    \setlength\@tempdima{1.5em}%
%    \begingroup
%      \parindent \z@ \rightskip \@pnumwidth
%      \parfillskip -\@pnumwidth
%      \leavevmode \bfseries \color{thegray}
%      \advance\leftskip\@tempdima
%      \hskip -\leftskip
%      (#1)\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss#2\hspace*{3cm}}\par
%      \penalty\@highpenalty
%    \endgroup
%  \fi}


\hypersetup{%
  colorlinks=true,
  linkcolor=\hypersetuplinkcolor@cx}

%\@dottedtocline{<level>}{<indent>}{<numwidth>}{<title>}{<page>}: Macro
%to produce a table of contents line with the following parameters:
\renewcommand*\l@section{\@dottedtocline{1}{\tocsectionindent@cx}{\tocsectionnumberwidth@cx}}
\renewcommand*\l@subsection{\@dottedtocline{2}{\tocsubsectionindent@cx}{3.2em}}
\renewcommand*\l@subsubsection{\@dottedtocline{3}{\tocsubsubsectionindent@cx}{4.1em}}
\renewcommand*\l@paragraph{\@dottedtocline{4}{\tocparagraphindent@cx}{5em}}
\renewcommand*\l@subparagraph{\@dottedtocline{5}{\tocsubparagraphindent@cx}{6em}}
%% How to modify to achieve good boxing? \makebox
%\def\numberline#1{\makebox[2cm]{\textcolor{black}{#1}}}

\def\@dottedtocline#1#2#3#4#5{%
 \hsize12cm
 \ifnum #1>\c@tocdepth \else
 \vskip \z@ \@plus.2\p@
 {\leftskip #2\relax \rightskip \@tocrmarg \parfillskip -\rightskip
 \parindent #2\relax\@afterindenttrue
 \interlinepenalty\@M
 \leavevmode
 \@tempdima #3\relax
 \advance\leftskip \@tempdima \null\nobreak\hskip -\leftskip
%% Changes to definitions to accommodate keys
 % \vbox{\hsize10cm \raggedright\par \hangindent2.5em #4\par}\nobreak%title
{#4}\nobreak%title
 \leaders\hbox{$\m@th
%If a document uses fonts other than computer modern, the use of a dot from math
%can be very disturbing despite the fact that this might be the only place in a
%document that then uses computer modern. Therefore we surround the dot with
%an \hbox to escape to the surrounding text font.
 \mkern \@dotsep mu\hbox{.}\mkern \@dotsep
 mu$}\hfill
 \nobreak
 \hb@xt@\@pnumwidth{\hfil
\normalfont \normalcolor\color{\toctitlecolor@cx} #5}%page
 \par}%
\fi}

% We set a counter for every time we print a chapter 
% toc image.
% The images are saved by convention as tocblocnumber.
% this could also come from a key in fututre versions
\newcounter{img}
\setcounter{img}{1}


% We redefine the command to allow for key values and to enable
% custom designs to co-exist

\renewcommand*\l@chapter[2]{%
  % example of a toc custom design
\def\toccustom##1##2{% CAN BE MOVED TO ADD CONTENTS AT CHAPTER
 \par\vspace*{10pt}
        ##1\toctitleafter@cx##2\par\vspace*{-10pt}
        \hspace*{-2.1cm}\vbox to 0pt{\par\rule{.01pt}{22pt}\par
        \IfFileExists{./chapters/tocblock\theimg.JPG}{%
           \includegraphics[width=2.5cm]{tocblock\theimg}}\par\vspace*{\tocchapterafter@cx}
        }{\vspace*{10pt}}
 \stepcounter{img}
}

  %#1 number and title  #2 page number
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ %\rightskip \@pnumwidth
      %\parfillskip -\@pnumwidth
%      \leavevmode \bfseries \color{thegray}
%      \advance\leftskip\@tempdima
%      \hskip -\leftskip
      \if@tocimage 
           \toccustom{#1}{#2}%
     \else
         #1\toctitleafter@cx#2\par\vspace*{-10pt}%
        \hspace*{-2.1cm}%
     \fi
     
     \penalty\@highpenalty
    \endgroup
\fi}



%%% HEADER AND FOOTER SETTINGS AND STYLES
\newif\if@headertoprule
\newif\if@headerbottomrule
\cxset{
   chaptermark name color/.store in=\chaptermarknamecolor@cx,
   chaptermark title color/.store in=\chaptermarktitlecolor@cx,
   chaptermark title before/.store in=\chaptermarktitlebefore@cx,
   chaptermark after number/.store in=\chaptermarkafternumber@cx,
   chaptermark name/.store in=\chaptermarkname@cx,
   chaptermark numbering/.is choice,
   leftmark before/.store in=\leftmarkbefore@cx,
   leftmark after/.store in=\leftmarkafter@cx,
   rightmark before/.store in=\rightmarkbefore@cx,
   rightmark after/.store in=\rightmarkafter@cx,
   chaptermark numbering/none/.code=\def\chaptermarknumber{},
   sectionmark name/.is choice,
   sectionmark name/none/.code=\def\sectionmarkname@cx{},
   sectionmark name custom/.code=\def\sectionmarkname@cx{#1},
   sectionmark number/.is choice,
   sectionmark number/none/.code=\def\sectionmarknumber@cx{},
   sectionmark after number/.store in=\sectionmarkafternumber@cx,
   sectionmark name color/.store in=\sectionmarkcolor@cx,
   sectionmark title font/.store in=\sectionmarktitlefont@cx,
   sectionmark title color/.store in=\sectionmarktitlecolor@cx,
   sectionmark before title/.store in=\sectionmarkbeforetitle@cx,
   sectionmark after title/.store in=\sectionmarkaftertitle@cx,
   header offset even/.store in=\headeroffseteven@cx,
   header offset odd/.store in=\headeroffsetodd@cx,
  %
   header top rule/.is if=@headertoprule,
   header bottom rule/.is if=@headerbottomrule,
   author block=false,
}

%% Set defaults
\cxset{ header offset even=0pt,
          header offset odd=0pt,
          rightmark before=,
          rightmark after=,
}

\cxset{pagestyle/.code=\pagestyle{#1}}

\cxset{headings ruled-01/.style={pagestyle=headings,
          header style=headings,
          chaptermark name color=theblue,
          chaptermark after number={\thinspace:\space },
          chaptermark name=,%\@chapapp,
          chaptermark title color=black!80,
          leftmark before=\thepage\hfill, 
          leftmark after=,
          sectionmark name color=theblue,
          sectionmark title color=black!80,
          header offset even=0pt,
          header offset odd=0pt,
          header top rule=false,
          header bottom rule=true}}

\cxset{headings ruled-02/.style={pagestyle=headings,
          header style=headings,
          chaptermark name color=theblue,
          chaptermark after number=,
          chaptermark name=,%\@chapapp,
          chaptermark numbering=none,
          chaptermark title color=black!80,
          sectionmark name=none,
          sectionmark number=none,
          leftmark before=,
          leftmark after=\qquad\quad\thepage,
          rightmark before=\thepage,
          rightmark after=\hfill\hfill,
          sectionmark name color=theblue,
          sectionmark title color=black!80,
          sectionmark after title=,
          sectionmark after number=\qquad,
          header top rule=false,
          header bottom rule=true,
          header offset even=1.5cm,
          header offset odd=-1.5cm,
          header bottom rule=false}}

\cxset{%
          header style=headings,
          chaptermark name color=black,
          chaptermark after number={\thinspace:\space },
          chaptermark title color=black!80,
          sectionmark name color=black,
          sectionmark title color=black!80,
          header top rule=false,
          header bottom rule=true}  


\cxset{headings boxedpagenumber/.style={
          pagestyle=headings,
          header style=headings,
% Chaptermarks 
          chaptermark name color=black,
          chaptermark after number=,
          chaptermark name={\bfseries SHORT BOOK TITLE},
          chaptermark numbering=none,
          chaptermark title color=black!80,
          chaptermark title before=\@gobble,
% Leftmarks
          leftmark before=\colorbox{thegray!50}{\thepage\quad}\quad, %even pages
          leftmark after=\hfill\hfill,
% Right marks influenced by chapter name?
          rightmark before=\colorbox{thegray!50}{\thepage\quad}\quad, %odd pages
          rightmark after=\hfill\hfill,
% Section marks
          sectionmark name custom=\chaptertitle@cx,
          sectionmark number=none,
          sectionmark name color=black,
          sectionmark title color=black!80,
          sectionmark before title=\@gobble, % we do not need the section title
          sectionmark after title=\hfill\hfill,
          sectionmark after number=,
%  rules we remove or inherit
%       header top rule=false,
          header bottom rule=true,
          header offset even=-1.3cm,
          header offset odd=-1.3cm,
          }}

%% QUANTUM FRONTIER
\cxset{headings titlestyle/.style={
          pagestyle=headings,
          header style=headings,
          headings boxedpagenumber,
% Chaptermarks 
          chaptermark name color=black,
          chaptermark after number=,
          chaptermark name={\bfseries The Quantum Frontier},
          chaptermark numbering=none,
          chaptermark title color=black!80,
          chaptermark title before=\@gobble,
% Leftmarks
          leftmark before=\thepage\quad, %even pages
          leftmark after=\hfill\hfill,
% Right marks influenced by chapter name?
          rightmark before=\hfill\hfill, %odd pages
          rightmark after=\thepage,
% Section marks
          sectionmark name custom=\chaptertitle@cx,
          sectionmark number=none,
          sectionmark name color=black,
          sectionmark title color=black!80,
          sectionmark before title=\@gobble, % we do not need the section title
          sectionmark after title=\quad,
          sectionmark after number=,
%  rules we remove or inherit
          header top rule=false,
          header bottom rule=false,
          header offset even=0pt,
          header offset odd=0pt,
          }}

%% EVOLUTION OF THE INSECTS
\cxset{headings style58/.style={
 %         pagestyle=headings,
%          header style=headings,
          headings titlestyle,
% Chaptermarks 
          %chaptermark name color=black,
          %chaptermark after number=,
          chaptermark name={\bfseries EVOLUTION OF THE INSECTS},
          %chaptermark numbering=none,
          %chaptermark title color=black!80,
          %chaptermark title before=\@gobble,
% Leftmarks
          leftmark before=\thepage\quad\hfill\hfill, %even pages
          leftmark after=,
% Right marks influenced by chapter name?
          rightmark before=, %odd pages
          rightmark after=\hfill\hfill\thepage,
% Section marks
%          sectionmark name custom=\chaptertitle@cx,
%          sectionmark number=none,
%          sectionmark name color=black,
%          sectionmark title color=black!80,
%          sectionmark before title=\@gobble, % we do not need the section title
%          sectionmark after title=\quad,
%          sectionmark after number=,
%%  rules we remove or inherit
%          header top rule=false,
%          header bottom rule=false,
%          header offset even=0pt,
%          header offset odd=0pt,
          }}



%% HEADERS AND FOOTERS
\if@twoside
  \def\ps@headings{%
      \let\@oddfoot\@empty
      \def\@oddfoot{\rule{\textwidth}{0.4pt}}
      \let\@evenfoot\@empty
      \def\@evenhead{\parbox{\textwidth}{%
                                   \leavevmode
                                   \if@headertoprule\rule{\textwidth}{0.4pt}%
                                       \vskip2pt plus1pt minus1pt\fi
%typesetter
                                     \hskip\headeroffseteven@cx\hbox to \textwidth{%
                                           \leftmarkbefore@cx
                                           \leftmark
                                           \leftmarkafter@cx
                                     }%
                                     \if@headerbottomrule\vskip-7pt plus1pt minus1pt
                                    \rule{\textwidth}{0.4pt}\fi%
          }% end parbox
       }%
%% Defines the odd head
      \def\@oddhead{
         \parbox{\textwidth}{%
                                   \leavevmode
                                   \if@headertoprule\rule{\textwidth}{0.4pt}%
                                       \vskip2pt plus1pt minus1pt\fi
%typesetter
                                     \hskip\headeroffsetodd@cx\hbox to \textwidth{%
                                           \rightmarkbefore@cx
                                           \rightmark
                                           \rightmarkafter@cx
                                     }%
                                     \if@headerbottomrule\vskip-7pt plus1pt minus1pt
                                    \rule{\textwidth}{0.4pt}\fi%
          }% end parbox
      }%
      \let\@mkboth\markboth
 % chaptermark called by chapter and also by table of contents etc. This is essentially a 
%  leftmark
\def\chaptermark##1{%
     \gdef\chaptertitle@cx{##1}%
      \markboth {%
       \ifnum \c@secnumdepth >\m@ne
          \if@mainmatter%
              \color{\chaptermarknamecolor@cx}%
              \MakeUppercase{\chaptermarkname@cx\ }%
              \chaptermarknumber%
              \chaptermarkafternumber@cx%
          \fi
        \fi
        \color{\chaptermarktitlecolor@cx}%
       % \hfill%
        \MakeUppercase{\chaptermarktitlebefore@cx{##1}}}{}%
}%end chaptermark
% section
  \def\sectionmark##1{%
      \markright {%
        \ifnum \c@secnumdepth >\z@
           {\bfseries\textcolor{\sectionmarkcolor@cx}{\sectionmarkname@cx\sectionmarknumber@cx\sectionmarkafternumber@cx}%
        } %
  \fi
         \color{\sectionmarktitlecolor@cx}\MakeUppercase{\normalfont\sffamily \sectionmarkbeforetitle@cx{##1}\sectionmarkaftertitle@cx}}}}%
\else
  \def\ps@headings{%
    \let\@oddfoot\@empty
    \def\@oddhead{{\slshape\rightmark}\hfil\thepage}%
    \let\@mkboth\markboth
    \def\chaptermark##1{%
      \markright {%
        \ifnum \c@secnumdepth >\m@ne
          \if@mainmatter
            \@chapapp\ \thechapter... \ %
          \fi
        \fi
        ##1}}}
\fi
\def\ps@myheadings{%
    \let\@oddfoot\@empty\let\@evenfoot\@empty
    \def\@evenhead{\thepage\hfil\slshape\leftmark}%
    \def\@oddhead{{\slshape\rightmark}\hfil\thepage}%
    \let\@mkboth\@gobbletwo
    \let\chaptermark\@gobble
    \let\sectionmark\@gobble
 }

% We define some special headers for convenience. This one is for double
% images for the oxford and tufte-styles.

\def\ps@caption{%
    \let\@oddfoot\@empty\let\@evenfoot\@empty
    \def\@evenhead{\begin{picture}(0,0)
           \put(-150,-200){A funny caption}
         \end{picture}}%
    \let\@oddhead\@evenhead
    \let\@mkboth\@gobbletwo
    \let\chaptermark\@gobble
    \let\sectionmark\@gobble
 }

%%%%%%%%%%%%%%%%%%%%%%%%%%% END HEADERS


\@specialfalse
\renewcommand\tableofcontents{%
\cxset{chapter before=\vspace*{-50pt},
       chapter toc=none, 
       numbering=none, 
       chapter opening=right, title font-color=\color{black},
       title font-size=\Large, title font-shape=\upshape,
       name={},
       title before=\hspace*{-2.1cm}\parbox{3.3cm}{\includegraphics{tocblock01}},
}
    \if@twocolumn
      \@restonecoltrue\onecolumn
    \else
      \@restonecolfalse
    \fi
    % \pagestyle{empty}
    \chapter{\contentsname}%had UPPER CASE
     \@starttoc{toc}%
    \if@restonecol\twocolumn\fi
    \cxset{chapter toc=true, toc image=false}
    }


%% PRODUCES THE COVER PAGE OF THE DOCUMENTATION
\newcommand\coverpage[3]{%
\vbox{%
  \vspace*{-2\baselineskip}
  \hskip-3.95cm\includegraphics[width=\paperwidth]{#1}\par
 % \putimage[width=17cm,offsetx=0cm, offsety=3\baselineskip, border=0pt,padding=0pt]{cockfight}\par
  \vspace*{3\baselineskip}
   \hbox to \hsize{\Huge \hfill\hfill{\MakeUppercase{\bfseries \textsf{ A NEW LOOK AT  }}}}
   \vspace*{0.3cm}
   \hbox to \hsize{\Huge \hfill\hfill{\MakeUppercase{\bfseries \textsf{LATEX  book design}}}}
  \vspace*{2\baselineskip}
   \hbox to \hsize{\huge \hfill\hfill\textsf{\hbox{#2}}}
    \vspace*{1.35cm}
   \hbox to \hsize{\huge \hfill\hfill\textsf{\hbox{#3}}}
}
}

%% We define a command for the second page of the documentation
\newcommand\secondpage{\clearpage\null\vfill\vfill
\thispagestyle{empty}
\begin{minipage}[b]{0.9\textwidth}
\includegraphics[width=3cm]{hine02}\par
\raggedright
\textit{Cover image: }
The cover image shows Jo Bodeon, a back-roper in the mule room at Chace Cotton Mill. Burlington, Vermont. This and other similar images in this book were taken by Lewis W. Hine, in the period between 1908-1912. These images as well as social campaigns by many including Hine, helped to formulate America's anti-child labour laws.
\end{minipage}\par
\vspace*{\baselineskip}
\begin{minipage}[b]{0.9\textwidth}
\raggedright
\setlength{\parskip}{0.5\baselineskip}
Copyright \copyright 2012  Dr Yiannis Lazarides\par
Permission is granted to copy, distribute and\slash or modify this document under the terms of the GNU Free Documentation License, version 1.2, with no invariant sections, no front-cover texts, and no back-cover texts.\par
A copy of the license is included in the appendix.\par
This document is distributed in the hope that it will be useful, but without any warranty; without even the implied warranty of merchantability or fitness for a particular purpose.
\end{minipage}
\vspace*{2\baselineskip}
\clearpage
}

%% Some special styles
%     \begin{macrocode}
\IfFileExists{changepage.sty}{%
  \PassOptionsToPackage{strict}{changepage}
  \RequirePackage{changepage}
  }{}
\IfFileExists{rotating.sty}{\RequirePackage{rotating}}{}
%    \end{macrocode}
%
% \begin{macro}{\even@samplepage}

% \begin{macro}{\odd@samplepage}
%    \begin{macrocode}
\def\even@samplepage{%
 \begin{picture}(0,0)
   \put(\Xeven,\Yeven){\turnbox{90}{\Huge \textcolor{\watermark@textcolor}{\watermark@text}}}
\end{picture}
}
%% Define a macro to print SAMPLE PAGE IN THE MARGIN
\def\odd@samplepage{%
 \begin{picture}(0,0)
   \put(\Xodd,\Yodd){\turnbox{90}{\Huge \textcolor{\watermark@textcolor}{\watermark@text}}}
 \end{picture}
}
%    \end{macrocode}
% \begin{macro}{watermarktext}
%  Define the watermark words
%    \begin{macrocode}
\def\watermarktext#1{\gdef\watermark@text{\fontfamily{phv}\selectfont#1}}
\def\watermarktextcolor#1{\gdef\watermark@textcolor{#1}}
\watermarktext{SAMPLE PAGE}
\watermarktextcolor{purple}
%    \end{macrocode}
% \end{macro}
%    \begin{macrocode}
%% redefine LaTeX's plain as myplain for headings
\def\ps@samplepage{\let\@mkboth\@gobbletwo
 \let\@oddhead\odd@samplepage\def\@oddfoot{\reset@font\hfil\thepage}
 \let\@evenhead\even@samplepage\def\@evenfoot{\reset@font\thepage\hfil}}
%%
%
%% We define two macros to position the watermark on the page
\def\Xodd{500}
\def\Xeven{-70}\def\Yeven{-810}
\def\Yeven{-\expandafter\strip@pt\textheight}
\let\Yodd\Yeven


\cxset{blank page text/.store in=\blankpagetext@cx{#1}}

\def\cleardoublepage{\clearpage\if@twoside\ifodd\c@page\else
  \hbox{}
  \vspace*{\fill}
  \begin{center}
     \blankpagetext@cx      
  \end{center}
  \vspace{\fill}
  \thispagestyle{empty}
  \newpage
  \if@twocolumn\hbox{}\newpage\fi\fi\fi}

\parindent1.5em

%% Examples for documentation
\newcounter{texexp}[chapter]
\@addtoreset{c@texexp}{c@chapter}
\def\thetexexp{\thesection.\arabic{texexp}}
\tcbset{
texexp/.style={%
   fonttitle=\small\sffamily\bfseries, fontupper=\small, fontlower=\small},
  example/.code 2 args={\refstepcounter{texexp}\label{#2}}%
  \pgfkeysalso{texexp,title={Example \thetexexp\ #1}},
}


\newenvironment{texexp}[1]{\tcblisting{texexp,#1}}{\endtcblisting}
\newenvironment{example}[3][]{\tcblisting{example={#2}{#3},#1}}{\endtcblisting}
%%rename to avoid clashes with other classes that use it

\newenvironment{texexample}[3][]{\tcblisting{example={#2}{#3},#1}}{\endtcblisting}


% Define a macro to hold the name of this package.
\def\athena{\textcolor{thered}{athena}}
% 
% Be nice to hackers define a boolean to know if the package was loaded
\newif\if@athena
\@athenatrue

% STOLEN FROM TUFTE
% \RaggedRight allows hyphenation

\RequirePackage{ragged2e}
\setlength{\RaggedRightRightskip}{\z@ plus 0.08\hsize}
\setlength{\RaggedRightParindent}{1pc}

% Paragraph indentation and separation for normal text
\newcommand{\@tufte@reset@par}{%
  \setlength{\RaggedRightParindent}{1.0pc}%
  \setlength{\parindent}{1pc}%
  \setlength{\parskip}{0pt}%
}
\@tufte@reset@par

% Paragraph indentation and separation for marginal text
\newcommand{\@tufte@margin@par}{%
  \setlength{\RaggedRightParindent}{0.5pc}%
  \setlength{\parindent}{0.5pc}%
  \setlength{\parskip}{0pt}%
}
% Use Donald Arseneau's improved float parameters for the documentation and 
% to develop sensible values.
\renewcommand{\topfraction}{.5}
\renewcommand{\bottomfraction}{.7}
\renewcommand{\textfraction}{.04}
\renewcommand{\floatpagefraction}{.92} % have a high one don't encourage it
\renewcommand{\dbltopfraction}{.66}
\renewcommand{\dblfloatpagefraction}{.66}
\setcounter{topnumber}{9}
\setcounter{bottomnumber}{9}
\setcounter{totalnumber}{20}
\setcounter{dbltopnumber}{9}

% Some people might prefer setting the author fields as macros
\newcommand\addauthors[1]{%
   \cxset{author names=#1}
}

%%%%%%%%%%%%% CHAPTERS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cxset{custom/.code=\gdef\customdesign@cx{\csname#1\endcsname}\@specialtrue,
       fill/.store in=\fill@cx}
%\cxset{stefan/.style={fill=purple, title font-color=\color{white},
%          custom=tikzspecials}}


\cxset{steward/.style={
  offsety/.store in=\soffsety,
  image/.store in=\image@cx,
  texti/.store in=\texti@cx,
  textii/.store in=\textii@cx,
  header style=empty,
}}


\newcommand\tikzspecial[2][]{%
     \clearpage

     \begin{tikzpicture}[remember picture,overlay]
     % Main shading block
     \node [xshift=5cm,yshift=-\paperheight] at (current page.north west)
        [text width=0.98\textwidth,text height=\paperheight, fill=thecream!30,above right]
        {};
      \node [xshift=6.5cm,yshift=-1.5cm-\soffsety] at (current page.north west)
         [text width=0.7\textwidth,below right]{\sffamily \bfseries \huge\raggedright #2\par};

        \node [xshift=3cm,yshift=-1.5cm] at (current page.north west)
      [text width=3cm,align=center,minimum height=2.5cm, fill=blue,below right]
	{$$\text{\HHUGE\bfseries\sffamily\color{white}\thechapter}$$
	\par\vspace*{3pt}
	};

	\node [xshift=-0.2cm,yshift=-21.5cm] at (current page.north west)
	[text width=3cm,above right]%
	{\includegraphics[width=1.0\paperwidth]{./chapters/\image@cx}};
	% second box left
	\node [xshift=3cm,yshift=-19.5cm] at (current page.north west)
	[text width=9cm,minimum height=2.5cm,inner sep=0.5em, fill=blue,below right]
	{\color{white}
 	 \bfseries\sffamily \texti@cx
	};
	% Last block
	\node [xshift=6.5cm,yshift=-26cm] at (current page.north west)
	[text width=12cm,above right]
	{\textii@cx};
	\end{tikzpicture}
\par
\thispagestyle{empty}
\clearpage
}%end tikzspecial

\cxset{steward,
  chapter toc=true,
  numbering=arabic,
  custom=tikzspecial,
  offsety=0cm,
  image=hine03,
  texti={Type some text here by setting texti},
  textii={Type some text here by setting textii},
 }


%% EDDOUARD MANET

\cxset{manet/.style={
 chapter opening=anywhere,
 chapter toc=true,
 toc image=false,
 name={},
 numbering=none,
 number font-size=,
 number font-family=,
 number font-weight=,
 number before={\vspace*{-2.5cm}},
 number dot={},
 number after={},
 number position=leftname,
 chapter font-family=,
 chapter font-weight=,
 chapter font-size=,
 chapter before={},
 chapter after={},
 chapter color={black!90},
 number color=\color{purple},
 title beforeskip={},
 title afterskip={},
 title before={\hskip-2.3cm\includegraphics[width=1.25\textwidth]{./chapters/manet}\par
    \par\hfill\hfill{\tiny\bfseries Manet's  \textit{The Barmaid.}}\\
    \par
    \vspace*{\baselineskip}
    \par\hfill},
 title after={\hfill\hfill},
 title font-family=\sffamily,
 title font-color=\color{black!80},
 title font-weight=\bfseries,
 title font-size=\LARGE,
 header style=plain}}

\def\topimage#1{\cxset{title before={\vspace*{\headsep}\hspace*{\dimexpr(-\marginparwidth-2.1cm-\marginparsep)}\includegraphics[width=\paperwidth]{./chapters/#1}\par
\vspace*{\baselineskip}\par}}}
% need to reset 
\cxset{manet, toc image=true}
\begin{document}

\frontmatter
\pagestyle{empty}
%\coverpage{hine02}{Yiannis Lazarides}{Published by Camel Press}savinggrace,vespa

\coverpage{bird-brain}{Yiannis Lazarides}{Published by Camel Press}
\secondpage
\thispagestyle{samplepage}
\input{title}
% Must move from here
\cxset{blank page text=\epigraph{We all agree that your theory is crazy. 
          But is it crazy enough?}{Niels Bohr}}

%%%%%%%%%%%  MAIN MATTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\mainmatter

\pagestyle{plain}
\@specialfalse
\tableofcontents
\listoftables
\listoffigures


\cxset{toc image=true}
\part{The Package}


\pagestyle{plain}
\setdefaults

%\input{tikztutorial.tex}
%
%
\input{introduction.tex}
%\input{chapterdesign.tex}
%\input{fonts.tex}
%\input{epigraphschapter.tex}
%\input{lowerlevelheadingsopening.tex}
%\input{lowerlevelheadings.tex}
%\input{specialdesigns.tex}
\input{headersandfooters01.tex}
\input{headersandfooters.tex}
%\input{generalsettings.tex}
\input{captionsandothers.tex} NEED TO RESTORE
\input{geometry}
\input{barmaid}
%
%\restoregeometry
%\input{cardinal}
%\input{versochapter}
%\input{style01.tex}
%\input{style02.tex}
%\input{style03.tex}
%\input{style04.tex}
%\input{style05.tex}
%\input{style06.tex}
%\input{style07.tex}
%\input{style08.tex}
%\input{style09.tex}
%%\input{style10.tex}
%%\input{style11.tex}
%%\input{style12.tex}
%%\input{style13} % CHECK FOR ERRORS
%%\input{style14}
%%\input{style15}
%%\input{style16}
%%\input{style17}
%%\input{style18.tex}
%%\input{style19.tex}
%%\input{style20.tex}
%%\input{style20a.tex} % depend on 20
%%\input{style21.tex}
%%\input{style22.tex}
%%\input{style23.tex}
%%\input{style24.tex}
%%\input{style25.tex}
%%\input{style26.tex}
%%\input{style27.tex}
%%\input{style28.tex}
%%\input{style29.tex}
%%\input{style30.tex}
%%\input{style31.tex}
%%\input{style32.tex}
%%\input{style33.tex}
%%\input{style34.tex}
%%\input{style35.tex}  TO DO
%%\input{style36.tex}
%%\input{style37.tex}
%%\input{style38.tex} % fix author block
%\input{style39.tex}
%\input{style40.tex}
%\input{style41.tex}
%\input{style42.tex}
%\input{style43.tex}
%%\input{style45.tex} LOTS OF ERRORS
%\input{style49.tex}
%\input{style50.tex}
%\input{style51.tex}
%\input{style52.tex}
%\input{style53.tex}
%\input{style54.tex}
%\input{appendices.tex}
%\input{quotations}
%\input{lists}
%\input{docmacros.tex}
%\input{tikztutorial.tex}
%\input{bibliographies.tex}

% Index
\printindex


\end{document}
https://docs.google.com/open?id=0B75n0wtctw00RDhYSkIwOTBRRHU5Rl93Q19lalRlQQ